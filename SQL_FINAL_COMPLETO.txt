-- EXECUTE TUDO DE UMA VEZ!

BEGIN;

-- 1. Atualizar subscriptions
UPDATE subscriptions
SET user_id = 'f7a15f22-9699-4b04-9f9d-0d48dd558989'
WHERE user_id = 'a30b5935-3bdc-4b30-a78b-346d10c287c4';

-- 2. Atualizar links
UPDATE links
SET user_id = 'f7a15f22-9699-4b04-9f9d-0d48dd558989'
WHERE user_id = 'a30b5935-3bdc-4b30-a78b-346d10c287c4';

-- 3. Atualizar quiz_results (se existir)
UPDATE quiz_results
SET user_id = 'f7a15f22-9699-4b04-9f9d-0d48dd558989'
WHERE user_id = 'a30b5935-3bdc-4b30-a78b-346d10c287c4';

-- 4. Atualizar leads (se existir)
UPDATE leads
SET user_id = 'f7a15f22-9699-4b04-9f9d-0d48dd558989'
WHERE user_id = 'a30b5935-3bdc-4b30-a78b-346d10c287c4';

-- 5. Atualizar course_access (se existir)
UPDATE course_access
SET user_id = 'f7a15f22-9699-4b04-9f9d-0d48dd558989'
WHERE user_id = 'a30b5935-3bdc-4b30-a78b-346d10c287c4';

-- 6. AGORA SIM: Atualizar professionals (Ãºltimo passo!)
UPDATE professionals
SET id = 'f7a15f22-9699-4b04-9f9d-0d48dd558989'
WHERE id = 'a30b5935-3bdc-4b30-a78b-346d10c287c4';

-- 7. Verificar
SELECT 
    p.id,
    p.email,
    p.name,
    COUNT(DISTINCT s.id) as subscriptions,
    COUNT(DISTINCT l.id) as links
FROM professionals p
LEFT JOIN subscriptions s ON p.id = s.user_id
LEFT JOIN links l ON p.id = l.user_id
WHERE p.email = 'marcela_roberto@hotmail.com'
GROUP BY p.id, p.email, p.name;

COMMIT;

